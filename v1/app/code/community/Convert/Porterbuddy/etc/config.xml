<?xml version="1.0" encoding="UTF-8" ?>
<!--
/**
 * @author Convert Team
 * @copyright Copyright (c) 2017 Convert (http://www.convert.no/)
 */
-->
<config>
    <modules>
        <Convert_Porterbuddy>
            <version>1.5.0</version>
        </Convert_Porterbuddy>
    </modules>
    <global>
        <models>
            <convert_porterbuddy>
                <class>Convert_Porterbuddy_Model</class>
            </convert_porterbuddy>
        </models>
        <resources>
            <convert_porterbuddy>
                <setup>
                    <module>Convert_Porterbuddy</module>
                    <class>customer/entity_setup</class>
                </setup>
            </convert_porterbuddy>
        </resources>
        <helpers>
            <convert_porterbuddy>
                <class>Convert_Porterbuddy_Helper</class>
            </convert_porterbuddy>
        </helpers>
        <blocks>
            <convert_porterbuddy>
                <class>Convert_Porterbuddy_Block</class>
            </convert_porterbuddy>
        </blocks>
        <events>
            <sales_convert_quote_address_to_order>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>orderCreateChangeShippingDescription</method>
                    </convert_porterbuddy>
                </observers>
            </sales_convert_quote_address_to_order>
            <sales_order_shipment_save_before>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>shipmentSaveBeforeSendShipment</method>
                    </convert_porterbuddy>
                </observers>
            </sales_order_shipment_save_before>
        </events>
        <fieldsets>
            <customer_address>
                <pb_location>
                    <to_quote_address>*</to_quote_address>
                </pb_location>
            </customer_address>
            <sales_convert_quote_address>
                <pb_location>
                    <to_order_address>*</to_order_address>
                </pb_location>
                <pb_user_edited>
                    <to_order_address>*</to_order_address>
                </pb_user_edited>
            </sales_convert_quote_address>
            <sales_convert_quote>
                <pb_leave_doorstep>
                    <to_order>*</to_order>
                </pb_leave_doorstep>
                <pb_comment>
                    <to_order>*</to_order>
                </pb_comment>
            </sales_convert_quote>
        </fieldsets>
    </global>
    <frontend>
        <routers>
            <convert_porterbuddy>
                <use>standard</use>
                <args>
                    <module>Convert_Porterbuddy</module>
                    <frontName>porterbuddy</frontName>
                </args>
            </convert_porterbuddy>
        </routers>
        <layout>
            <updates>
                <convert_porterbuddy module="Convert_Porterbuddy">
                    <file>convert/porterbuddy.xml</file>
                </convert_porterbuddy>
                <convert_porterbuddy_popup_assets module="Convert_Porterbuddy">
                    <!-- for easier override of whole popup assets -->
                    <file>convert/porterbuddy_popup_assets.xml</file>
                </convert_porterbuddy_popup_assets>
            </updates>
        </layout>
        <translate>
            <modules>
                <Convert_Porterbuddy>
                    <files>
                        <default>Convert_Porterbuddy.csv</default>
                    </files>
                </Convert_Porterbuddy>
            </modules>
        </translate>
        <events>
            <core_block_abstract_to_html_after>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>shippingMethodsAvailableToHtmlAddWidget</method>
                    </convert_porterbuddy>
                </observers>
            </core_block_abstract_to_html_after>
            <sales_order_payment_place_end>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>paymentPlaceAfterCheckPaid</method>
                    </convert_porterbuddy>
                </observers>
            </sales_order_payment_place_end>
            <sales_order_save_before>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>orderSaveBeforeCheckPaid</method>
                    </convert_porterbuddy>
                </observers>
            </sales_order_save_before>
            <sales_order_save_commit_after>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>orderSaveCommitAfter</method>
                    </convert_porterbuddy>
                </observers>
            </sales_order_save_commit_after>
        </events>
    </frontend>
    <admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <Convert_Porterbuddy before="Mage_Adminhtml">Convert_Porterbuddy_Adminhtml</Convert_Porterbuddy>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
    <adminhtml>
        <translate>
            <modules>
                <Convert_Porterbuddy>
                    <files>
                        <default>Convert_Porterbuddy.csv</default>
                    </files>
                </Convert_Porterbuddy>
            </modules>
        </translate>
        <events>
            <controller_action_layout_render_before_adminhtml_sales_order_address>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>layoutGenerateAfterAddAddressLocationForm</method>
                    </convert_porterbuddy>
                </observers>
            </controller_action_layout_render_before_adminhtml_sales_order_address>
            <core_block_abstract_to_html_after>
                <observers>
                    <convert_porterbuddy>
                        <type>singleton</type>
                        <class>convert_porterbuddy/observer</class>
                        <method>adminOrderTabInfoToHtmlAddDetails</method>
                    </convert_porterbuddy>
                </observers>
            </core_block_abstract_to_html_after>
        </events>
    </adminhtml>
    <crontab>
        <jobs>
            <convert_porterbuddy>
                <schedule>
                    <cron_expr>* * * * *</cron_expr>
                </schedule>
                <run>
                    <model>convert_porterbuddy/cron::sendShipments</model>
                </run>
            </convert_porterbuddy>
        </jobs>
    </crontab>
    <default>
        <carriers>
            <cnvporterbuddy>
                <active>0</active>
                <model>convert_porterbuddy/carrier</model>
                <title>Express Shipping With Porterbuddy</title>
                <description>Simple and flexible. You decide when and where delivery will take place, at home, at work or elsewhere.</description>
                <asap_name>Express shipping</asap_name>
                <days_ahead>1</days_ahead>
                <timeslot_cutoff>1</timeslot_cutoff>
                <timeslot_window>2</timeslot_window>
                <asap_cutoff>1</asap_cutoff>
                <hours_mon>00:00,24:00</hours_mon>
                <hours_tue>00:00,24:00</hours_tue>
                <hours_wed>00:00,24:00</hours_wed>
                <hours_thu>00:00,24:00</hours_thu>
                <hours_fri>00:00,24:00</hours_fri>
                <hours_sat>00:00,24:00</hours_sat>
                <hours_sun>00:00,24:00</hours_sun>
                <return_enabled>1</return_enabled>
                <return_text>I would like to return items that do not match me</return_text>
                <return_short_text>+ included return</return_short_text>
                <return_price>79</return_price>
                <leave_doorstep_text>Allow the courier to leave the package outside the door</leave_doorstep_text>
                <comment_text>Optional message to the courier</comment_text>
                <discount_type>none</discount_type>
                <auto_create_shipment>1</auto_create_shipment>
                <create_shipment_timeout>5</create_shipment_timeout>
                <api_mode>development</api_mode>
                <development_api_key backend_model="adminhtml/system_config_backend_encrypted"/>
                <development_api_secret backend_model="adminhtml/system_config_backend_encrypted"/>
                <testing_api_key backend_model="adminhtml/system_config_backend_encrypted"/>
                <testing_api_secret backend_model="adminhtml/system_config_backend_encrypted"/>
                <production_api_key backend_model="adminhtml/system_config_backend_encrypted"/>
                <production_api_secret backend_model="adminhtml/system_config_backend_encrypted"/>
                <inbound_token backend_model="adminhtml/system_config_backend_encrypted"/>
                <maps_api_key backend_model="adminhtml/system_config_backend_encrypted"/>
                <maps_zoom>16</maps_zoom>
                <popup_title>Your goods are on their way!</popup_title>
                <popup_description>To be sure we deliver correctly, please mark your entrance door on the map by pressing where the entrance door of your accommodation/building is.</popup_description>
                <popup_address_text>Ship to</popup_address_text>
                <default_phone_code>+47</default_phone_code>
                <containers backend_model="adminhtml/system_config_backend_serialized" />
                <weight_unit>KILOGRAM</weight_unit>
                <dimension_unit>CENTIMETER</dimension_unit>
                <!-- internal constants -->
                <development_api_url>https://api.porter.altoros.com</development_api_url>
                <testing_api_url>https://api.porter-staging.altoros.com</testing_api_url>
                <production_api_url>https://api.porterbuddy.com</production_api_url>
                <refresh_token_before_expiration_time>30</refresh_token_before_expiration_time>
                <default_location>59.3909072,11.309796</default_location>
                <default_zoom>6</default_zoom>
            </cnvporterbuddy>
        </carriers>
    </default>
</config>

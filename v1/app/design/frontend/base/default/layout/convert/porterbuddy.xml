<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * @author Convert Team
 * @copyright Copyright (c) 2017 Convert (http://www.convert.no/)
 */
-->
<layout>
    <!-- timeslots widget -->
    <checkout_onepage_index>
        <update handle="convert_porterbuddy_checkout_methods" />
    </checkout_onepage_index>

    <checkout_onepage_shippingmethod>
        <update handle="convert_porterbuddy_checkout_methods" />
    </checkout_onepage_shippingmethod>

    <convert_porterbuddy_checkout_methods>
        <update handle="convert_porterbuddy_assets" />
        <!-- rendered in observer for onepage -->
        <block type="convert_porterbuddy/widget" name="porterbuddy_widget" template="convert/porterbuddy/widget/js.phtml">
            <block type="convert_porterbuddy/widget" name="porterbuddy_widget_content" as="content" template="convert/porterbuddy/widget/widget.phtml" />
        </block>
    </convert_porterbuddy_checkout_methods>

    <checkout_onepage_success>
        <update handle="convert_porterbuddy_location_popup" />
    </checkout_onepage_success>

    <!-- use this handle in custom checkout confirmation pages -->
    <convert_porterbuddy_location_popup>
        <update handle="convert_porterbuddy_assets" />
        <update handle="convert_porterbuddy_popup_assets" />
        <block type="convert_porterbuddy/popup" name="porterbuddy_popup" template="convert/porterbuddy/popup/popup.phtml">
            <block type="convert_porterbuddy/popup" name="porterbuddy_popup_content" as="js" template="convert/porterbuddy/popup/js.phtml" />
        </block>
        <reference name="after_body_start">
            <action method="append" ifconfig="carriers/cnvporterbuddy/active">
                <block>porterbuddy_popup</block>
            </action>
        </reference>
    </convert_porterbuddy_location_popup>

    <!-- Porterbuddy's JS and CSS, reusable for widget and popup -->
    <convert_porterbuddy_assets>
        <reference name="head">
            <action method="addItem" ifconfig="carriers/cnvporterbuddy/active">
                <type>skin_js</type>
                <script>js/convert/porterbuddy.js</script>
            </action>
            <action method="addCss" ifconfig="carriers/cnvporterbuddy/active">
                <name>css/convert/porterbuddy.css</name>
            </action>
        </reference>
    </convert_porterbuddy_assets>
</layout>
